
<!-- Buttons below the logo -->

<div class="top-buttons-container">
  <button
    class="top-large-btn"
    [class.active-btn]="activeView === 'basket'"
    type="button"
    (click)="setActiveView('basket')"
  >
    Basket of Goods
  </button>
  <button
    class="top-large-btn"
    [class.active-btn]="activeView === 'products'"
    type="button"
    (click)="setActiveView('products')"
  >
    Product Prices
  </button>
</div>

<div *ngIf="activeView === 'basket'">
  <p class="description-text">
    This chart below tracks the total cost of a basket of goods based on the available prices of goods collected.
  </p>
  <div class="chart-container-wrapper">
    <canvas id="basketChart"></canvas>
  </div>

  <table class="compact-table basket-table">
    <thead>
      <tr>
        <th>Product</th>
        <th *ngFor="let quarter of basketTableData.quarters">{{ quarter }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let product of basketTableData.products">
        <td>
          <a [routerLink]="['/products', productToSlug(product.name)]">
            {{ product.name }}
          </a>
        </td>
        <td *ngFor="let price of product.prices; let i = index"
            [class.estimate-cell]="isEstimateCell(product.name, i)">
          {{ price !== null ? ('$' + price.toFixed(2)) : '-' }}
        </td>
      </tr>
      <tr>
        <td>Total</td>
        <td *ngFor="let total of basketTableData.totals">
          ${{ total.toFixed(2) }}
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="activeView === 'products'">
  <p class="description-text">
    <span *ngIf="!showAllProducts">This table displays the products with at least {{ minPricesThreshold }} prices collected.</span>
    <span *ngIf="showAllProducts">This table is displaying all the products with a price collected.</span>
  </p>
  <table class="compact-table">
    <thead>
      <tr>
        <th class="sortable" (click)="setSort('Product')">
          Product
          <span *ngIf="sortColumn === 'Product'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
        </th>
        <th class="prices-collected-header sortable" (click)="setSort('pricesCollected')">
          <span class="prices-collected-full">Prices Collected</span>
          <span class="prices-collected-short">#</span>
          <span *ngIf="sortColumn === 'pricesCollected'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
        </th>
        <th class="sortable" (click)="setSort('averagePrice')">
          Average Price
          <span *ngIf="sortColumn === 'averagePrice'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
        </th>
        <th class="sortable" (click)="setSort('latestDate')">
          Latest Date
          <span *ngIf="sortColumn === 'latestDate'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
        </th>
        <th class="sortable" (click)="setSort('latestPrice')">
          Latest Price
          <span *ngIf="sortColumn === 'latestPrice'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
        </th>
        <th class="annual-increase-header sortable" (click)="setSort('annualizedIncrease')">
          <span class="annual-increase-full">Annualized Increase %</span>
          <span class="annual-increase-short">Annual Incrse %</span>
          <span *ngIf="sortColumn === 'annualizedIncrease'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
        </th>
      </tr>
    </thead>
    <tbody>
      @for (stat of filteredStats; track stat) {
        <tr>
          <td>
            <a [routerLink]="['/products', productToSlug(stat.Product)]">
              {{ stat.Product }}
            </a>
          </td>
          <td>{{ stat.pricesCollected }}</td>
          <td>$ {{ stat.averagePrice }}</td>
          <td>{{ stat.latestDate }}</td>
          <td>$ {{ stat.latestPrice }}</td>
          <td>{{ stat.annualizedIncrease }}</td>
        </tr>
      }
    </tbody>
  </table>

  <div class="toggle-single-price-link">
    <a href="#" (click)="$event.preventDefault(); showAllProducts = !showAllProducts">
      {{ showAllProducts ? 'Show only basket of goods' : 'Show all products' }}
    </a>
  </div>
